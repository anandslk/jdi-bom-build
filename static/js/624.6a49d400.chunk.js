"use strict";(self.webpackChunkreact_widget_template=self.webpackChunkreact_widget_template||[]).push([[624],{3215:(e,t,r)=>{r.d(t,{A:()=>u});var n=r(5043),o=r(174),s=r(2725),a=r(8012),i=r(3277),l=r(2670),c=r(6713),d=r(579);const u=()=>{const{handleDrop:e}=(0,a.A)(),{showSuccessToast:t,showErrorToast:r}=(0,s.A)(),[u,p]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{if(!window.widget)return;console.trace("[WidgetLifecycle] \ud83d\udd04 `onRefresh` was called from:"),window.widget.addEvent("onRefresh",(async()=>{var n,s;const a=(new Error).stack.split("\n"),c=sessionStorage.getItem("userClickedRefresh");if((e=>e.some((e=>e.includes("UWA_Frame_Alone.js")||e.includes("bundle-min.js"))))(a)&&!c)return void console.warn("[WidgetLifecycle] \u26d4 Auto-refresh detected. Ignoring unwanted `onRefresh`.");sessionStorage.removeItem("userClickedRefresh"),p(!0);const d=l.A.getState().droppedObject.droppedObjectData.initialDraggedData;if(null===d||void 0===d||null===(n=d.data)||void 0===n||null===(s=n.items)||void 0===s||!s.length)return console.error("[WidgetLifecycle] \u26a0\ufe0f `initialDraggedData` is missing or invalid:",d),void p(!1);try{await(0,o.M)(d.data.items,e)}catch(u){console.error("[WidgetLifecycle] \u274c Error during refresh:",u),r(i.H6)}finally{p(!1),t(i._l)}}))}),[]),u?(0,d.jsx)(c.A,{}):null}},6713:(e,t,r)=>{r.d(t,{A:()=>o});r(5043);var n=r(579);const o=()=>(0,n.jsx)("div",{className:"loader-container",children:(0,n.jsx)("div",{className:"loader"})})},8012:(e,t,r)=>{r.d(t,{A:()=>d});var n=r(5043),o=r(3003),s=r(5645),a=r(360),i=r(314),l=r(2725),c=r(3277);const d=()=>{const{showErrorToast:e}=(0,l.A)(),{fetchRevisionsAndParents:t}=(0,a.A)(),r=(0,o.wA)(),d=(0,o.d4)((e=>e.droppedObject.isDropped)),u=(0,o.d4)((e=>e.droppedObject.loading)),p=(0,n.useCallback)((async n=>{try{const l=await(0,i.Sj)({dataItems:n});if(l.success){var o,a;const e=l.data.cardData.relativePath,[i]=await Promise.all([t(null===(o=n[0])||void 0===o?void 0:o.objectId,null===(a=n[0])||void 0===a?void 0:a.objectType,e)]);r((0,s.um)({cardData:l.data.cardData,parentDetails:i||[]})),console.log("[fetchObjectDetails] \u2705 Redux store updated.")}else e(c.wX)}catch(l){console.error("[FetchObjectDetails] Error fetching details:",l),e(c.wX)}finally{console.log("[fetchObjectDetails] \ud83c\udfc1 Ensuring loading is reset."),r((0,s.r1)(!1))}}),[r,t,e]),h=(0,n.useCallback)((async t=>{console.log("[handleDrop] handleDrop called with dataItems:",t);try{if(t&&t.length>0){var n;const o=null===(n=t[0])||void 0===n?void 0:n.objectType;if(!["VPMReference","Document","Raw_Material"].includes(o))return void e(c.Zo);r((0,s.Rr)(!0)),console.log("[handleDrop] \ud83d\udd04 Force setting `loading = true`..."),r((0,s.r1)(!1)),setTimeout((()=>r((0,s.r1)(!0))),0),await p(t)}else console.warn("[handleDrop] No data items to process.")}catch(o){console.error("[Drop] Error in handleDrop:",o),r((0,s.r1)(!1)),console.log("[handleDrop] Error in handleDrop, setting loading to false"),e(c.nz)}}),[p,e]);return{initializeDroppableArea:(0,n.useCallback)((()=>{d?console.log("[initializeDroppableArea] \u23f3 isDropped is already true. Skipping reset."):(console.log("[initializeDroppableArea] \ud83d\ude80 Resetting isDropped to false..."),r((0,s.Rr)(!1)));const t=setInterval((()=>{const n=document.querySelector(".droppable-container");n&&(clearInterval(t),(0,i.pn)(n,h,r,e))}),100);return()=>clearInterval(t)}),[h,r]),loading:u,handleDrop:h}}},360:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(2725),o=r(3862),s=r(3277);const a=()=>{const{showSuccessToast:e,showErrorToast:t}=(0,n.A)();return{fetchRevisionsAndParents:async(e,t,r)=>{if(!r)return void console.error("[Fetch Revisions] \u274c Missing relative path.");try{const n=await o.A.post("/revFloat/getParents",{data:{id:e,type:t,relativePath:r}});if(200===n.status){return n.data}throw new Error("[Fetch Revisions] HTTP error! status: ".concat(n.status))}catch(n){return console.error("[Fetch Revisions] \u274c Error occurred:",n),null}},replaceRevisions:async(r,n,a)=>{try{const t=await o.A.post("/revFloat/floatRevisions",{SelectedParents:r,DroppedData:n,userEmail:a});if(200===t.status)return console.log("Replacement successful:",t.data),e(s.hG),{success:!0};throw new Error("[Replacement API] HTTP error! status: ".concat(t.status))}catch(i){return console.error("Error during replacement:",i),t(s.mK),{success:!1,error:i.message}}}}}},2725:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(9379),o=r(3986),s=r(7488);const a=["message","type","position","autoClose","hideProgressBar","closeOnClick","pauseOnHover","pauseOnFocusLoss","draggable","theme","transition"],i=()=>{const e=e=>{let{message:t,type:r="default",position:i="top-right",autoClose:l=2e3,hideProgressBar:c=!1,closeOnClick:d=!0,pauseOnHover:u=!1,pauseOnFocusLoss:p=!1,draggable:h=!0,theme:g="light",transition:f=s.br}=e,m=(0,o.A)(e,a);(s.oR[r]||s.oR)(t,(0,n.A)({position:i,autoClose:l,hideProgressBar:c,closeOnClick:d,pauseOnHover:u,draggable:h,theme:g,transition:f},m))};return{showToast:e,showSuccessToast:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e((0,n.A)({message:t,type:"success"},r))},showErrorToast:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e((0,n.A)({message:t,type:"error"},r))},showInfoToast:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e((0,n.A)({message:t,type:"info"},r))},showWarningToast:function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e((0,n.A)({message:t,type:"warn"},r))}}}},624:(e,t,r)=>{r.r(t),r.d(t,{default:()=>$});var n=r(5043),o=r(4391),s=r(1240),a=r(3248),i=r(3003),l=r(9367),c=r(3768),d=r(7488),u=r(2670),p=r(579);const h=e=>{let{children:t}=e;const r=new s.E;return(0,p.jsx)(l.vd,{children:(0,p.jsx)(i.Kq,{store:u.A,children:(0,p.jsx)(a.Ht,{client:r,children:(0,p.jsxs)(n.Suspense,{fallback:(0,p.jsx)("h1",{children:"loading................"}),children:[(0,p.jsx)(c.l$,{position:"top-center",reverseOrder:!1}),(0,p.jsx)(d.N9,{position:"top-right",autoClose:2e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!1,pauseOnFocusLoss:!1,draggable:!0,theme:"light",transition:d.br}),t]})})})})};var g=r(3215);r(8885);let f=null;function m(e){if(function(){if(window.parent&&window.parent.document){let e=window.parent.document.createElement("script");e.textContent='\n      function listenForRefreshClicks() {\n        // console.log("\ud83c\udf0d [Parent] Listening for manual refresh clicks...");\n  \n        document.body.addEventListener("click", function (event) {\n          let refreshButton = event.target.closest("#refresh"); // Check if refresh was clicked\n  \n          if (refreshButton) {\n            // console.log("\u2705 [Parent] User clicked Refresh!");\n            sessionStorage.setItem("userClickedRefresh", "true"); // Store flag\n            // console.log("Stored Flag:", sessionStorage.getItem("userClickedRefresh"));\n          }\n        }, true);\n      }\n  \n      // \u2705 Ensure event listener is added even if DOM is already loaded\n      if (document.readyState === "loading") {\n        document.addEventListener("DOMContentLoaded", listenForRefreshClicks);\n      } else {\n        listenForRefreshClicks();\n      }\n    ',window.parent.document.body.appendChild(e)}else console.warn("\u26a0\ufe0f [index.js] Unable to inject script\u2014parent window not accessible.")}(),window.widget){let t=!1;window.widget.addEvent("onLoad",(()=>{t?console.warn("\u23f3 onLoad was already executed. Ignoring duplicate trigger."):(t=!0,function(e){var t;requirejs(["DS/PlatformAPI/PlatformAPI"],(e=>{window.PlatformAPI=e}));const r=window.widget;let n=(null===r||void 0===r||null===(t=r.body)||void 0===t?void 0:t.querySelector("#root"))||document.getElementById("root");n||(n=document.createElement("div"),n.id="root",((null===r||void 0===r?void 0:r.body)||document.body).appendChild(n)),f=f||(0,o.createRoot)(n),f.render((0,p.jsxs)(h,{children:[(0,p.jsx)(g.A,{}),e]}))}(e))}))}else console.error("\u274c Widget not detected! onLoad cannot be registered.");return e}var v=r(7055),x=r(3969),b=r(4799),j=r(5974),w=r(13),A=r(1449),y=r(2097),D=r(4842),O=r(3759);const P=e=>{let{parentParts:t,sourceOrg:r,selectedItems:n}=e;return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(j.A,{spacing:3,children:[(0,p.jsxs)(x.A,{children:[(0,p.jsx)(D.A,{variant:"subtitle1",sx:{fontWeight:"medium"},children:"Parent item(s) to Assign:"}),(0,p.jsx)(D.A,{variant:"body1",sx:{marginBottom:2,whiteSpace:"pre-line"},children:t})]}),(0,p.jsxs)(x.A,{children:[(0,p.jsx)(D.A,{variant:"subtitle1",sx:{fontWeight:"medium"},children:"Source Organization:"}),(0,p.jsx)(D.A,{variant:"body1",sx:{marginBottom:2},children:r})]}),(0,p.jsxs)(x.A,{children:[(0,p.jsx)(D.A,{variant:"subtitle1",sx:{fontWeight:"medium"},children:"Items to be Processed:"}),n.length>0?(0,p.jsx)(x.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,marginTop:1},children:n.map((e=>(0,p.jsx)(O.A,{label:e,color:"primary"},e)))}):(0,p.jsx)(D.A,{variant:"body2",color:"textSecondary",children:"No items selected."})]})]})})};var C=r(3546),R=r(3605),S=r(6020);const k=e=>{let{message:t}=e;return(0,p.jsxs)(b.A,{sx:{padding:4,width:"100%",maxWidth:600,borderRadius:4,boxShadow:3,textAlign:"center",backgroundColor:"#f5f5f5",border:"2px solid #3f51b5"},children:[(0,p.jsx)(x.A,{sx:{marginBottom:2},children:(0,p.jsx)(D.A,{variant:"h6",color:"primary",fontWeight:"bold",children:t})}),(0,p.jsx)(S.A,{color:"primary"})]})};function I(e){let{children:t,isOpen:r,onSubmit:o,onCancel:s,disabled:a,title:i}=e;const l=(0,n.useRef)(null);return(0,n.useEffect)((()=>{const e=new AbortController,{signal:t}=e;return r&&window.addEventListener("mousedown",(function(e){l.current&&!l.current.contains(e.target)&&s()}),{signal:t}),()=>e.abort()}),[r,s]),(0,p.jsx)("div",{className:"flex justify-center items-center",children:(0,p.jsx)(C.N,{children:r&&(0,p.jsx)(R.P.div,{className:"fixed inset-0 flex items-center justify-center backdrop-blur-xs bg-black/30 z-10",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,p.jsxs)(R.P.div,{ref:l,className:"bg-white rounded-2xl p-6 shadow-xl min-w-[70%] md:min-w-[40%] max-w-[60%]",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},children:[(0,p.jsx)(D.A,{variant:"h5",sx:{fontWeight:"bold",textAlign:"center"},children:i}),a&&(0,p.jsx)("div",{className:"w-full flex justify-center py-4",children:(0,p.jsx)(k,{message:"Searching for parts..."})}),t,(0,p.jsxs)(j.A,{direction:"row",spacing:2,justifyContent:"flex-end",className:"pt-4",children:[(0,p.jsx)(y.A,{variant:"contained",color:"primary",onClick:o,disabled:a,children:"Confirm"}),(0,p.jsx)(y.A,{variant:"outlined",color:"secondary",onClick:s,disabled:a,children:"Cancel"})]})]})})})})}var E=r(3774),T=r(7122);const L=(0,E.eU)(!1);var W=r(5103),F=r(8309),N=r(1880);const H=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST";return{query:r=>({url:e,method:t,body:r})}},q=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"POST";return{query:r=>{let{params:n,body:o}=r,s=e;return n&&(s=Object.entries(n).reduce(((e,t)=>{let[r,n]=t;return e.replace(":".concat(r),encodeURIComponent(n))}),e)),{url:s,method:t,body:o}}}},B=e=>({query:t=>{const r=t?"?"+Object.entries(t).map((e=>{let[t,r]=e;return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(r))})).join("&"):"";return{url:"".concat(e).concat(r),method:"GET"}}}),U=Object.freeze({API_URL:"http://localhost:5001/api/v1",NODE_ENV:"production"}),_=Object.entries(U).filter((e=>{let[t,r]=e;return!r})).map((e=>{let[t]=e;return t}));_.length>0&&c.Ay.error("\u26a0\ufe0f Missing Required Environment Variables \u26a0\ufe0f\n\n".concat(_.map((e=>"\u2022 ".concat(e))).join("\n")),{duration:3e3,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",padding:"16px"}});const z=(0,W.xP)({reducerPath:"api",baseQuery:(0,F.cw)({baseUrl:U.API_URL,prepareHeaders:e=>{const t=N.A.get("token");return e.set("Authorization","Bearer ".concat(t)),e.set("Content-Type","application/json"),e.set("Accept","application/json"),e}}),endpoints:e=>({post:e.mutation(H("/")),rdoList:e.query(B("/rdo-list")),orgList:e.query(B("/org-list")),taskList:e.query(B("/tasks-list")),updateStatus:e.mutation(q("/task/:id/status","PATCH"))})}),{usePostMutation:M,useRdoListQuery:Q,useOrgListQuery:V,useTaskListQuery:G,useUpdateStatusMutation:J}=z,{}=z;var K=r(5906);const X=e=>{var t,r;let{selectedItems:n,onChange:o,disabled:s}=e;const a=e=>{!e||null!==n&&void 0!==n&&n.includes(e)||o([...n,e])},{data:i}=Q({}),{data:l}=V({});return(0,p.jsxs)(x.A,{sx:{width:"100%",display:"flex",flexDirection:"column",gap:2},children:[(0,p.jsx)(K.A,{options:null!==(t=null===i||void 0===i?void 0:i.data)&&void 0!==t?t:[],onChange:(e,t)=>a(t),renderInput:e=>(0,p.jsx)(w.A,(0,v.A)((0,v.A)({},e),{},{label:"RDO Name (will appear in Selected Plants)",fullWidth:!0,variant:"outlined",disabled:s}))}),(0,p.jsx)(K.A,{options:null!==(r=null===l||void 0===l?void 0:l.data)&&void 0!==r?r:[],onChange:(e,t)=>a(t),renderInput:e=>(0,p.jsx)(w.A,(0,v.A)((0,v.A)({},e),{},{label:"Destination JDI Orgs (will appear in Selected Plants)",fullWidth:!0,variant:"outlined",disabled:s}))}),(0,p.jsx)(D.A,{variant:"caption",color:"textSecondary",children:"Selections from both fields will appear below."}),(0,p.jsxs)(b.A,{sx:{padding:2,borderRadius:2,boxShadow:2,maxHeight:200,overflowY:"auto"},children:[(0,p.jsx)(D.A,{variant:"subtitle1",sx:{fontWeight:"bold",marginBottom:2},children:"Selected Plants"}),(0,p.jsx)(x.A,{sx:{display:"flex",flexWrap:"wrap",gap:1,minHeight:20},children:n.map((e=>(0,p.jsx)(O.A,{label:e,onDelete:()=>{return t=e,void o(null===n||void 0===n?void 0:n.filter((e=>e!==t)));var t},color:"primary"},e)))})]})]})};var Y=r(8012);const Z=()=>{const{initializeDroppableArea:e,loading:t}=(0,Y.A)(),{isDropped:r}=(0,i.d4)((e=>({cardData:e.droppedObject.droppedObjectData.cardData,parentDetails:e.droppedObject.droppedObjectData.parentDetails,isDropped:e.droppedObject.isDropped,initialDraggedData:e.droppedObject.droppedObjectData.initialDraggedData})),i.bN),o=(0,n.useRef)(!1);(0,n.useEffect)((()=>{o.current||(e(),o.current=!0)}),[e]),(0,n.useEffect)((()=>{console.log("[RevisionFloat] State Changes:",{loading:t,isDropped:r})}),[t,r]);const[s,a]=(0,n.useState)({}),[l,d]=(0,n.useState)({parentParts:"",sourceOrg:"",plants:[]}),u=(e,t)=>{d((r=>(0,v.A)((0,v.A)({},r),{},{[e]:t})))},{isOpen:h,setIsOpen:g}=(()=>{const[e,t]=(0,T.fp)(L);return{isOpen:e,setIsOpen:t}})(),f=()=>g(!1),[m,{isLoading:D}]=M();return(0,p.jsxs)(x.A,{sx:{minHeight:"calc(100vh - 65px)",backgroundColor:"#eef2f6"},children:[(0,p.jsx)(I,{isOpen:h,title:"Confirm Your Submission",onSubmit:async()=>{const{data:e,error:t}=await m({parentPart:l.parentParts,sourceOrg:l.sourceOrg,plants:l.plants});t&&c.Ay.error(function(e){if(e&&"object"===typeof e&&"data"in e){const t=e;if("object"===typeof t.data&&null!==t.data&&"message"in t.data)return t.data.message}return"object"===typeof e&&null!==e&&"message"in e?(console.error(e),e.message):"An unexpected error occurred."}(t)),g(!1),c.Ay.success(e.message)},onCancel:f,disabled:D,children:(0,p.jsx)(P,{parentParts:l.parentParts,sourceOrg:l.sourceOrg,selectedItems:l.plants})}),(0,p.jsxs)(x.A,{sx:{padding:4,display:"flex",flexDirection:"column",alignItems:"center",gap:4,minHeight:"calc(100vh - 200px)"},children:[(0,p.jsx)(b.A,{sx:{padding:4,width:"100%",maxWidth:600,borderRadius:4,boxShadow:3},children:(0,p.jsx)("form",{onSubmit:e=>{e.preventDefault();const t={};l.parentParts.trim()||(t.parentParts="Parent Part is required"),l.sourceOrg.trim()||(t.sourceOrg="Source org is required"),l.plants.length||(t.plants="Select either RDO Name or Destination JDI Org"),a(t),0===Object.keys(t).length&&g(!0)},children:(0,p.jsxs)(j.A,{spacing:3,children:[(0,p.jsx)(w.A,{label:"Parent item(s) to Assign",variant:"outlined",value:l.parentParts,onChange:e=>u("parentParts",e.target.value),error:!!s.parentParts,helperText:s.parentParts,fullWidth:!0}),(0,p.jsx)(w.A,{label:"Source Organization",variant:"outlined",value:l.sourceOrg,onChange:e=>u("sourceOrg",e.target.value),error:!!s.sourceOrg,helperText:s.sourceOrg,fullWidth:!0}),(0,p.jsx)(X,{selectedItems:l.plants,onChange:e=>u("plants",e),disabled:!1}),s.plants&&(0,p.jsx)(A.A,{severity:"error",children:s.plants}),(0,p.jsxs)(j.A,{direction:"row",spacing:2,justifyContent:"flex-end",children:[(0,p.jsx)(y.A,{type:"submit",variant:"contained",color:"primary",children:"Submit"}),(0,p.jsx)(y.A,{type:"button",variant:"outlined",color:"secondary",onClick:f,children:"Cancel"})]})]})})}),!1]})]})},$=()=>m((0,p.jsx)(Z,{}))},174:(e,t,r)=>{r.d(t,{M:()=>n});const n=async(e,t)=>{if(console.log("[refreshWidgetData] called with dataItems:",e),e&&0!==e.length)try{if("function"!==typeof t)throw new Error("[Refresh] handleDrop is not a function.");await t(e)}catch(r){console.error("[Refresh] Error during handleDrop execution:",r)}else console.warn("[Refresh] No dropped data available to refresh.")}}}]);
//# sourceMappingURL=624.6a49d400.chunk.js.map